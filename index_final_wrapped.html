<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistical Analysis Tool - GSS Data</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        const { Upload, X, Database, Loader } = (() => {
            const Upload = ({ size = 24, style = {} }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
            );
            
            const X = ({ size = 24 }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            );
            
            const Database = ({ size = 24, style = {} }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                    <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                    <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                    <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                </svg>
            );
            
            const Loader = ({ size = 24 }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{ animation: 'spin 1s linear infinite' }}>
                    <line x1="12" y1="2" x2="12" y2="6"></line>
                    <line x1="12" y1="18" x2="12" y2="22"></line>
                    <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
                    <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
                    <line x1="2" y1="12" x2="6" y2="12"></line>
                    <line x1="18" y1="12" x2="22" y2="12"></line>
                    <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
                    <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
                </svg>
            );
            
            return { Upload, X, Database, Loader };
        })();

        const StatisticalAnalyzer = () => {
          const [data, setData] = useState(null);
          const [variables, setVariables] = useState([]);
          const [variable1, setVariable1] = useState('');
          const [variable2, setVariable2] = useState('');
          const [results, setResults] = useState(null);
          const [dataSource, setDataSource] = useState('none');
          const [loading, setLoading] = useState(false);
          const [error, setError] = useState(null);

          // Load compressed GSS data from .gz file
          const loadGSSData = async () => {
            setLoading(true);
            setError(null);
            
            try {
              // Fetch the compressed file
              const response = await fetch('gss_data.json.gz');
              if (!response.ok) {
                throw new Error('Could not load GSS data file');
              }
              
              // Get the compressed data as array buffer
              const compressedData = await response.arrayBuffer();
              
              // Decompress using pako
              const decompressed = pako.inflate(new Uint8Array(compressedData), { to: 'string' });
              
              // Parse the JSON
              const gssData = JSON.parse(decompressed);
              
              setVariables(gssData.variables);
              setData(gssData.data);
              setDataSource('gss');
              setVariable1('');
              setVariable2('');
              setResults(null);
              setLoading(false);
            } catch (err) {
              setError('Failed to load GSS data. Make sure gss_data.json.gz is in the same folder as this HTML file.');
              setLoading(false);
              console.error('Error loading GSS data:', err);
            }
          };

          // Parse CSV file
          const handleFileUpload = (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
              const text = e.target.result;
              const rows = text.split('\n').map(row => 
                row.split(',').map(cell => cell.trim())
              ).filter(row => row.length > 1 && row.some(cell => cell));
              
              if (rows.length > 0) {
                const headers = rows[0];
                const vars = headers.map(h => ({
                  name: h,
                  label: h,
                  value_labels: {}
                }));
                setVariables(vars);
                setData(rows.slice(1));
                setDataSource('uploaded');
                setVariable1('');
                setVariable2('');
                setResults(null);
              }
            };
            reader.readAsText(file);
          };

          const getColumnData = (varName) => {
            const varIndex = variables.findIndex(v => v.name === varName);
            return data.map(row => row[varIndex]).filter(val => val != null && val !== '');
          };

          const applyValueLabel = (value, varName) => {
            const variable = variables.find(v => v.name === varName);
            if (!variable) return String(value);
            
            const strValue = String(value);
            if (variable.value_labels && variable.value_labels[strValue]) {
              return variable.value_labels[strValue];
            }
            return strValue;
          };

          const calculateContingencyTable = (col1Data, col2Data, var1Name, var2Name) => {
            const labeled1 = col1Data.map(v => applyValueLabel(v, var1Name));
            const labeled2 = col2Data.map(v => applyValueLabel(v, var2Name));
            
            const uniqueCol1 = [...new Set(labeled1)].sort();
            const uniqueCol2 = [...new Set(labeled2)].sort();
            
            const table = {};
            uniqueCol1.forEach(val1 => {
              table[val1] = {};
              uniqueCol2.forEach(val2 => {
                table[val1][val2] = 0;
              });
            });

            labeled1.forEach((val1, idx) => {
              const val2 = labeled2[idx];
              if (table[val1] && table[val1][val2] !== undefined) {
                table[val1][val2]++;
              }
            });

            return { table, uniqueCol1, uniqueCol2 };
          };

          const calculateChiSquare = (table, uniqueCol1, uniqueCol2) => {
            const rowTotals = {};
            const colTotals = {};
            let grandTotal = 0;

            uniqueCol1.forEach(row => {
              rowTotals[row] = 0;
              uniqueCol2.forEach(col => {
                rowTotals[row] += table[row][col];
              });
              grandTotal += rowTotals[row];
            });

            uniqueCol2.forEach(col => {
              colTotals[col] = 0;
              uniqueCol1.forEach(row => {
                colTotals[col] += table[row][col];
              });
            });

            let chiSquare = 0;
            uniqueCol1.forEach(row => {
              uniqueCol2.forEach(col => {
                const observed = table[row][col];
                const expected = (rowTotals[row] * colTotals[col]) / grandTotal;
                if (expected > 0) {
                  chiSquare += Math.pow(observed - expected, 2) / expected;
                }
              });
            });

            const df = (uniqueCol1.length - 1) * (uniqueCol2.length - 1);
            const pValue = chiSquarePValue(chiSquare, df);

            return { chiSquare, df, pValue, rowTotals, colTotals, grandTotal };
          };

          const chiSquarePValue = (chiSquare, df) => {
            if (df === 0) return 1;
            if (chiSquare < 0.001) return 1;
            
            const criticalValues = {
              1: [3.841, 6.635, 10.828],
              2: [5.991, 9.210, 13.816],
              3: [7.815, 11.345, 16.266],
              4: [9.488, 13.277, 18.467],
              5: [11.070, 15.086, 20.515],
              6: [12.592, 16.812, 22.458],
              8: [15.507, 20.090, 26.125],
              10: [18.307, 23.209, 29.588]
            };
            
            const levels = [0.05, 0.01, 0.001];
            if (criticalValues[df]) {
              for (let i = 0; i < levels.length; i++) {
                if (chiSquare < criticalValues[df][i]) {
                  return i === 0 ? ">0.05" : i === 1 ? "0.01-0.05" : "0.001-0.01";
                }
              }
              return "<0.001";
            }
            
            return chiSquare > 3.841 ? "<0.05" : ">0.05";
          };

          const calculateCorrelation = (col1Data, col2Data) => {
            const num1 = col1Data.map(v => parseFloat(v)).filter(v => !isNaN(v));
            const num2 = col2Data.map(v => parseFloat(v)).filter(v => !isNaN(v));
            
            const n = Math.min(num1.length, num2.length);
            if (n < 2) return null;

            const mean1 = num1.reduce((a, b) => a + b, 0) / n;
            const mean2 = num2.reduce((a, b) => a + b, 0) / n;

            let numerator = 0;
            let sum1Sq = 0;
            let sum2Sq = 0;

            for (let i = 0; i < n; i++) {
              const diff1 = num1[i] - mean1;
              const diff2 = num2[i] - mean2;
              numerator += diff1 * diff2;
              sum1Sq += diff1 * diff1;
              sum2Sq += diff2 * diff2;
            }

            const denominator = Math.sqrt(sum1Sq * sum2Sq);
            if (denominator === 0) return null;

            const r = numerator / denominator;
            const t = r * Math.sqrt(n - 2) / Math.sqrt(1 - r * r);
            const pValue = tTestPValue(Math.abs(t), n - 2);

            return { r, n, pValue };
          };

          const tTestPValue = (t, df) => {
            if (df < 1) return 1;
            
            const criticalT = {
              1: [12.706, 63.657],
              2: [4.303, 9.925],
              5: [2.571, 4.032],
              10: [2.228, 3.169],
              20: [2.086, 2.845],
              30: [2.042, 2.750],
              50: [2.009, 2.678],
              100: [1.984, 2.626],
              1000: [1.962, 2.581]
            };

            const dfKey = Object.keys(criticalT).map(Number).find(key => df <= key) || 1000;
            
            if (t < criticalT[dfKey][0]) return ">0.05";
            if (t < criticalT[dfKey][1]) return "<0.05";
            return "<0.01";
          };

          const handleAnalyze = () => {
            if (!variable1 || !variable2 || !data) return;

            const col1Data = getColumnData(variable1);
            const col2Data = getColumnData(variable2);

            const minLength = Math.min(col1Data.length, col2Data.length);
            const alignedCol1 = col1Data.slice(0, minLength);
            const alignedCol2 = col2Data.slice(0, minLength);

            const { table, uniqueCol1, uniqueCol2 } = calculateContingencyTable(
              alignedCol1, alignedCol2, variable1, variable2
            );
            const chiSquareResults = calculateChiSquare(table, uniqueCol1, uniqueCol2);
            const correlation = calculateCorrelation(alignedCol1, alignedCol2);

            const var1 = variables.find(v => v.name === variable1);
            const var2 = variables.find(v => v.name === variable2);

            setResults({
              table,
              uniqueCol1,
              uniqueCol2,
              chiSquare: chiSquareResults,
              correlation,
              var1Label: var1?.label || variable1,
              var2Label: var2?.label || variable2
            });
          };

          const reset = () => {
            setData(null);
            setVariables([]);
            setVariable1('');
            setVariable2('');
            setResults(null);
            setDataSource('none');
            setError(null);
          };

          return (
            <div style={{
              minHeight: '100vh',
              background: 'linear-gradient(135deg, #f5f7fa 0%, #e8eef3 100%)',
              fontFamily: '"Crimson Pro", "Merriweather", Georgia, serif',
              padding: '40px 20px'
            }}>
              <style>
                {`
                  @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Inter:wght@400;500;600&display=swap');
                  
                  @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                  }
                  
                  .stat-card {
                    background: white;
                    border-radius: 12px;
                    padding: 28px;
                    margin-bottom: 24px;
                    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
                    border: 1px solid rgba(0, 0, 0, 0.06);
                  }
                  
                  .upload-zone {
                    border: 2px dashed #cbd5e0;
                    border-radius: 12px;
                    padding: 48px 32px;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    background: #f8fafc;
                  }
                  
                  .upload-zone:hover {
                    border-color: #4a5568;
                    background: #ffffff;
                    transform: translateY(-2px);
                    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
                  }
                  
                  .select-input {
                    width: 100%;
                    max-width: 100%;
                    padding: 8px 12px;
                    border: 2px solid #e2e8f0;
                    border-radius: 8px;
                    font-size: 15px;
                    font-family: 'Inter', sans-serif;
                    transition: all 0.2s ease;
                    background: white;
                    overflow-y: auto;
                    cursor: pointer;
                  }
                  
                  .select-input:focus {
                    outline: none;
                    border-color: #2d3748;
                    box-shadow: 0 0 0 3px rgba(45, 55, 72, 0.1);
                  }
                  
                  .select-input option {
                    padding: 8px 12px;
                    cursor: pointer;
                    border-radius: 4px;
                    margin: 2px 0;
                    white-space: normal;
                    word-wrap: break-word;
                    line-height: 1.4;
                    min-height: 40px;
                  }
                  
                  .select-input option:hover {
                    background: #edf2f7;
                  }
                  
                  .select-input option:checked {
                    background: #4299e1;
                    color: white;
                  }
                  
                  .analyze-btn {
                    background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
                    color: white;
                    padding: 14px 32px;
                    border: none;
                    border-radius: 8px;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    font-family: 'Inter', sans-serif;
                    box-shadow: 0 4px 12px rgba(45, 55, 72, 0.2);
                  }
                  
                  .analyze-btn:hover:not(:disabled) {
                    transform: translateY(-2px);
                    box-shadow: 0 6px 20px rgba(45, 55, 72, 0.3);
                  }
                  
                  .analyze-btn:disabled {
                    opacity: 0.5;
                    cursor: not-allowed;
                  }
                  
                  .load-data-btn {
                    background: linear-gradient(135deg, #2b6cb0 0%, #2c5282 100%);
                    color: white;
                    padding: 16px 32px;
                    border: none;
                    border-radius: 8px;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    font-family: 'Inter', sans-serif;
                    box-shadow: 0 4px 12px rgba(43, 108, 176, 0.3);
                    display: inline-flex;
                    align-items: center;
                    gap: 12px;
                  }
                  
                  .load-data-btn:hover:not(:disabled) {
                    transform: translateY(-2px);
                    box-shadow: 0 6px 20px rgba(43, 108, 176, 0.4);
                  }
                  
                  .load-data-btn:disabled {
                    opacity: 0.7;
                    cursor: not-allowed;
                  }
                  
                  .results-table {
                    width: 100%;
                    border-collapse: collapse;
                    margin-top: 16px;
                    font-family: 'Inter', sans-serif;
                  }
                  
                  .results-table th,
                  .results-table td {
                    padding: 12px 16px;
                    text-align: left;
                    border-bottom: 1px solid #e2e8f0;
                  }
                  
                  .results-table th {
                    background: #f7fafc;
                    font-weight: 600;
                    color: #2d3748;
                    font-size: 14px;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                  }
                  
                  .results-table td {
                    color: #4a5568;
                  }
                  
                  .stat-value {
                    font-size: 32px;
                    font-weight: 700;
                    color: #2d3748;
                    margin: 8px 0;
                  }
                  
                  .stat-label {
                    font-size: 14px;
                    color: #718096;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                    font-family: 'Inter', sans-serif;
                    font-weight: 500;
                  }
                  
                  .percentage-cell {
                    font-size: 13px;
                    color: #718096;
                    font-family: 'Inter', monospace;
                  }
                  
                  .error-message {
                    background: #fed7d7;
                    border: 1px solid #fc8181;
                    color: #742a2a;
                    padding: 16px;
                    border-radius: 8px;
                    margin-top: 16px;
                    font-family: 'Inter', sans-serif;
                    font-size: 14px;
                  }
                `}
              </style>

              <div style={{ maxWidth: '1200px', margin: '0 auto', overflowX: 'hidden' }}>
                <div style={{ textAlign: 'center', marginBottom: '48px' }}>
                  <h1 style={{
                    fontSize: '48px',
                    fontWeight: '700',
                    color: '#1a202c',
                    marginBottom: '12px',
                    letterSpacing: '-1px'
                  }}>
                    Statistical Analysis Tool
                  </h1>
                  <p style={{
                    fontSize: '18px',
                    color: '#718096',
                    fontFamily: 'Inter, sans-serif',
                    maxWidth: '600px',
                    margin: '0 auto'
                  }}>
                    Analyze relationships between variables using chi-square tests and correlation analysis
                  </p>
                </div>

                {dataSource === 'none' ? (
                  <div className="stat-card">
                    <div style={{ textAlign: 'center', marginBottom: '32px' }}>
                      <button 
                        onClick={loadGSSData} 
                        className="load-data-btn"
                        disabled={loading}
                      >
                        {loading ? <Loader size={24} /> : <Database size={24} />}
                        {loading ? 'Loading GSS Data...' : 'Load General Social Survey Data'}
                      </button>
                      <p style={{
                        marginTop: '16px',
                        fontSize: '14px',
                        color: '#718096',
                        fontFamily: 'Inter, sans-serif'
                      }}>
                        Click to load the GSS dataset with all variable and value labels
                      </p>
                      
                      {error && (
                        <div className="error-message">
                          {error}
                        </div>
                      )}
                    </div>

                    <div style={{
                      textAlign: 'center',
                      margin: '32px 0',
                      fontSize: '16px',
                      color: '#a0aec0',
                      fontFamily: 'Inter, sans-serif',
                      fontWeight: '600'
                    }}>
                      OR
                    </div>

                    <label htmlFor="file-upload">
                      <div className="upload-zone">
                        <Upload size={48} style={{ color: '#4a5568', marginBottom: '16px' }} />
                        <h3 style={{
                          fontSize: '20px',
                          fontWeight: '600',
                          color: '#2d3748',
                          marginBottom: '8px',
                          fontFamily: 'Inter, sans-serif'
                        }}>
                          Upload Your Own CSV
                        </h3>
                        <p style={{
                          fontSize: '14px',
                          color: '#718096',
                          fontFamily: 'Inter, sans-serif'
                        }}>
                          Click to browse or drag and drop
                        </p>
                      </div>
                    </label>
                    <input
                      id="file-upload"
                      type="file"
                      accept=".csv"
                      onChange={handleFileUpload}
                      style={{ display: 'none' }}
                    />
                  </div>
                ) : (
                  <>
                    <div className="stat-card">
                      <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        marginBottom: '24px'
                      }}>
                        <h2 style={{
                          fontSize: '24px',
                          fontWeight: '700',
                          color: '#1a202c',
                          margin: 0
                        }}>
                          Select Variables
                        </h2>
                        <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>
                          {dataSource === 'gss' && (
                            <span style={{
                              padding: '6px 12px',
                              background: '#edf2f7',
                              borderRadius: '6px',
                              fontSize: '13px',
                              color: '#2d3748',
                              fontFamily: 'Inter, sans-serif',
                              fontWeight: '500'
                            }}>
                              ðŸ“Š GSS Data Loaded
                            </span>
                          )}
                          <button
                            onClick={reset}
                            style={{
                              background: 'none',
                              border: 'none',
                              cursor: 'pointer',
                              padding: '8px',
                              display: 'flex',
                              alignItems: 'center',
                              gap: '8px',
                              color: '#718096',
                              fontFamily: 'Inter, sans-serif',
                              fontSize: '14px'
                            }}
                          >
                            <X size={20} />
                            Reset
                          </button>
                        </div>
                      </div>

                      <div style={{
                        display: 'grid',
                        gridTemplateColumns: '1fr 1fr',
                        gap: '24px',
                        marginBottom: '24px',
                        maxWidth: '100%'
                      }}>
                        <div style={{ minWidth: 0 }}>
                          <label style={{
                            display: 'block',
                            marginBottom: '8px',
                            fontWeight: '600',
                            color: '#2d3748',
                            fontSize: '14px',
                            fontFamily: 'Inter, sans-serif'
                          }}>
                            Variable 1 (Rows)
                          </label>
                          <select
                            className="select-input"
                            value={variable1}
                            onChange={(e) => setVariable1(e.target.value)}
                            size="10"
                            style={{ height: '300px' }}
                          >
                            <option value="">Choose a variable...</option>
                            {variables.map((v, idx) => (
                              <option key={idx} value={v.name}>
                                {v.name} - {v.label}
                              </option>
                            ))}
                          </select>
                        </div>

                        <div style={{ minWidth: 0 }}>
                          <label style={{
                            display: 'block',
                            marginBottom: '8px',
                            fontWeight: '600',
                            color: '#2d3748',
                            fontSize: '14px',
                            fontFamily: 'Inter, sans-serif'
                          }}>
                            Variable 2 (Columns)
                          </label>
                          <select
                            className="select-input"
                            value={variable2}
                            onChange={(e) => setVariable2(e.target.value)}
                            size="10"
                            style={{ height: '300px' }}
                          >
                            <option value="">Choose a variable...</option>
                            {variables.map((v, idx) => (
                              <option key={idx} value={v.name}>
                                {v.name} - {v.label}
                              </option>
                            ))}
                          </select>
                        </div>
                      </div>

                      <button
                        className="analyze-btn"
                        onClick={handleAnalyze}
                        disabled={!variable1 || !variable2}
                      >
                        Analyze Variables
                      </button>
                    </div>

                    {results && (
                      <>
                        <div className="stat-card">
                          <h2 style={{
                            fontSize: '24px',
                            fontWeight: '700',
                            color: '#1a202c',
                            marginBottom: '8px'
                          }}>
                            Frequency Distribution
                          </h2>
                          <p style={{
                            fontSize: '14px',
                            color: '#718096',
                            marginBottom: '20px',
                            fontFamily: 'Inter, sans-serif'
                          }}>
                            {results.var1Label} Ã— {results.var2Label}
                          </p>

                          <table className="results-table">
                            <thead>
                              <tr>
                                <th></th>
                                {results.uniqueCol2.map(col => (
                                  <th key={col}>{col}</th>
                                ))}
                                <th>Total</th>
                              </tr>
                            </thead>
                            <tbody>
                              {results.uniqueCol1.map(row => (
                                <tr key={row}>
                                  <td style={{ fontWeight: '600' }}>{row}</td>
                                  {results.uniqueCol2.map(col => (
                                    <td key={col}>{results.table[row][col]}</td>
                                  ))}
                                  <td style={{ fontWeight: '600' }}>
                                    {results.chiSquare.rowTotals[row]}
                                  </td>
                                </tr>
                              ))}
                              <tr style={{ background: '#f7fafc' }}>
                                <td style={{ fontWeight: '600' }}>Total</td>
                                {results.uniqueCol2.map(col => (
                                  <td key={col} style={{ fontWeight: '600' }}>
                                    {results.chiSquare.colTotals[col]}
                                  </td>
                                ))}
                                <td style={{ fontWeight: '700' }}>
                                  {results.chiSquare.grandTotal}
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>

                        <div className="stat-card">
                          <h2 style={{
                            fontSize: '24px',
                            fontWeight: '700',
                            color: '#1a202c',
                            marginBottom: '20px'
                          }}>
                            Row Percentages
                          </h2>

                          <table className="results-table">
                            <thead>
                              <tr>
                                <th></th>
                                {results.uniqueCol2.map(col => (
                                  <th key={col}>{col}</th>
                                ))}
                              </tr>
                            </thead>
                            <tbody>
                              {results.uniqueCol1.map(row => (
                                <tr key={row}>
                                  <td style={{ fontWeight: '600' }}>{row}</td>
                                  {results.uniqueCol2.map(col => {
                                    const pct = (results.table[row][col] / results.chiSquare.rowTotals[row] * 100).toFixed(1);
                                    return (
                                      <td key={col} className="percentage-cell">{pct}%</td>
                                    );
                                  })}
                                </tr>
                              ))}
                            </tbody>
                          </table>
                        </div>

                        <div className="stat-card">
                          <h2 style={{
                            fontSize: '24px',
                            fontWeight: '700',
                            color: '#1a202c',
                            marginBottom: '20px'
                          }}>
                            Column Percentages
                          </h2>

                          <table className="results-table">
                            <thead>
                              <tr>
                                <th></th>
                                {results.uniqueCol2.map(col => (
                                  <th key={col}>{col}</th>
                                ))}
                              </tr>
                            </thead>
                            <tbody>
                              {results.uniqueCol1.map(row => (
                                <tr key={row}>
                                  <td style={{ fontWeight: '600' }}>{row}</td>
                                  {results.uniqueCol2.map(col => {
                                    const pct = (results.table[row][col] / results.chiSquare.colTotals[col] * 100).toFixed(1);
                                    return (
                                      <td key={col} className="percentage-cell">{pct}%</td>
                                    );
                                  })}
                                </tr>
                              ))}
                            </tbody>
                          </table>
                        </div>

                        <div style={{
                          display: 'grid',
                          gridTemplateColumns: '1fr 1fr',
                          gap: '24px'
                        }}>
                          <div className="stat-card">
                            <h2 style={{
                              fontSize: '24px',
                              fontWeight: '700',
                              color: '#1a202c',
                              marginBottom: '24px'
                            }}>
                              Chi-Square Test
                            </h2>

                            <div style={{ marginBottom: '24px' }}>
                              <div className="stat-label">Ï‡Â² Statistic</div>
                              <div className="stat-value">
                                {results.chiSquare.chiSquare.toFixed(3)}
                              </div>
                            </div>

                            <div style={{ marginBottom: '24px' }}>
                              <div className="stat-label">Degrees of Freedom</div>
                              <div className="stat-value">{results.chiSquare.df}</div>
                            </div>

                            <div>
                              <div className="stat-label">P-Value</div>
                              <div className="stat-value" style={{
                                color: typeof results.chiSquare.pValue === 'string' && 
                                       results.chiSquare.pValue.includes('<') ? '#c53030' : '#2d3748'
                              }}>
                                {results.chiSquare.pValue}
                              </div>
                            </div>
                          </div>

                          <div className="stat-card">
                            <h2 style={{
                              fontSize: '24px',
                              fontWeight: '700',
                              color: '#1a202c',
                              marginBottom: '24px'
                            }}>
                              Correlation Analysis
                            </h2>

                            {results.correlation ? (
                              <>
                                <div style={{ marginBottom: '24px' }}>
                                  <div className="stat-label">Pearson Correlation (r)</div>
                                  <div className="stat-value">
                                    {results.correlation.r.toFixed(4)}
                                  </div>
                                </div>

                                <div style={{ marginBottom: '24px' }}>
                                  <div className="stat-label">Sample Size</div>
                                  <div className="stat-value">{results.correlation.n}</div>
                                </div>

                                <div>
                                  <div className="stat-label">Significance</div>
                                  <div className="stat-value" style={{
                                    color: typeof results.correlation.pValue === 'string' && 
                                           results.correlation.pValue.includes('<') ? '#c53030' : '#2d3748'
                                  }}>
                                    {results.correlation.pValue}
                                  </div>
                                </div>
                              </>
                            ) : (
                              <p style={{
                                color: '#718096',
                                fontFamily: 'Inter, sans-serif',
                                fontSize: '15px'
                              }}>
                                Correlation analysis requires numeric data. The selected variables appear to be categorical.
                              </p>
                            )}
                          </div>
                        </div>
                      </>
                    )}
                  </>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<StatisticalAnalyzer />, document.getElementById('root'));
    </script>
</body>
</html>
